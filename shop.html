<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Set shop - ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="shop-styles.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="shop-nav">
        <div class="nav-container">
            <div class="logo">SET<span>SHOP</span></div>
            <div class="nav-right">
                <span id="user-display" class="user-greeting">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
                <span id="user-balance" class="user-greeting"
                    style="color: #4CAF50; font-weight: 700; background: rgba(76,175,80,0.1); padding: 4px 10px; border-radius: 4px; cursor: pointer;"
                    title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô:
                    0 S</span>
                <button id="topup-btn" class="nav-btn topup-btn">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 1v22M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
                    </svg>
                    ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô
                </button>
                <button id="history-btn" class="nav-btn history-btn">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M1 4v6h6"></path>
                        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                        <path d="M12 7v5l3 3"></path>
                    </svg>
                    ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠
                </button>
                <a id="admin-link" href="admin.html" class="nav-btn"
                    style="display: none; background-color: #ff9900; color: #111; text-decoration: none; align-items: center; border-color: #ff9900;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö</a>
                <button id="logout-btn" class="nav-btn logout-btn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>
    </nav>

    <!-- Main Shop Area -->
    <main class="shop-container">
        <!-- Announcement Section -->
        <div class="announcement-section">
            <div class="section-header">
                <div class="title-area">
                    <h2 class="main-title"><span class="dot"></span> ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏à‡∏≤‡∏Å‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô</h2>
                    <p class="sub-title">Shop Announcement</p>
                </div>
            </div>
            <div class="announcement-card premium-card">
                <div class="announcement-content">
                    <div class="announcement-header">
                        <div class="logo">SET<span>SHOP</span></div>
                        <h3>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h3>
                    </div>

                    <div class="announcement-body">
                        <div class="rules-section">
                            <h4><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="#ff9900"
                                    stroke-width="2">
                                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                                </svg> Rules & Regulations</h4>
                            <ul>
                                <li>‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡∏≠‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏Å‡∏£‡∏ì‡∏µ</li>
                                <li>‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏≠‡∏á ‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÉ‡∏î‡πÜ ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</li>
                                <li>‡∏´‡∏≤‡∏Å‡∏ó‡∏≥‡∏ú‡∏¥‡∏î‡∏Å‡∏é‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÇ‡∏Å‡∏á ‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Blacklist ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
                                <li>‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÇ‡∏õ‡∏£‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÇ‡∏î‡∏ô‡πÅ‡∏ö‡∏ô ‡πÇ‡∏õ‡∏£‡∏î‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢</li>
                            </ul>
                        </div>

                        <div class="rules-section">
                            <h4><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="#ff9900"
                                    stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" />
                                </svg> Terms of Service</h4>
                            <ul>
                                <li>‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏ã‡∏±‡∏û‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</li>
                                <li>‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏Å‡∏î Ticket ‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î 24 ‡∏ä‡∏°.</li>
                            </ul>
                        </div>

                        <div class="rules-section" style="border-left: 1px solid #2d2e32; padding-left: 30px;">
                            <h4><svg viewBox="0 0 24 24" width="18" height="18" fill="#7289da">
                                    <path
                                        d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037 19.736 19.736 0 0 0-4.885 1.515.069.069 0 0 0-.032.027C.533 9.048-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.28 14.28 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128c.125-.094.249-.192.37-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.1.246.198.37.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z" />
                                </svg> Top-up Discord</h4>
                            <p style="font-size: 14px; color: #b8b8b8; margin-bottom: 12px;">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏≤‡∏á Discord
                                ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ 24 ‡∏ä‡∏°.</p>
                            <a href="https://discord.gg/Bcj7bnVXcU" target="_blank" class="popup-link"
                                style="font-size: 13px; text-align: center;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà Discord</a>
                        </div>
                    </div>

                    <div class="announcement-footer">
                        <span>‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÇ‡∏î‡∏¢ Set Shop</span>
                        <span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 6 ‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå 2026</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Orders Carousel -->
        <div class="recent-orders-section">
            <div class="section-header">
                <div class="title-area">
                    <h2 class="main-title"><span class="dot"></span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h2>
                </div>
            </div>
            <div class="carousel-container">
                <div class="carousel-track" id="carousel-track">
                    <!-- Carousel items will be injected here -->
                </div>
            </div>
        </div>

        <div class="section-header">
            <div class="title-area">
                <h2 class="main-title"><span class="dot"></span>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h2>
                <p class="sub-title">Product Recommended</p>
            </div>
            <button class="see-more-btn">‡∏î‡∏π‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</button>
        </div>

        <div class="products-grid" id="products-grid">
            <!-- Products will be generated here by JavaScript -->
        </div>
    </main>

    <!-- Announcement Popup Modal -->
    <div id="announcement-popup" class="announcement-popup-overlay">
        <div class="popup-box">
            <button class="popup-close-btn" onclick="closePopup()">&times;</button>
            <div class="popup-content">
                <div class="popup-icon">
                    <svg viewBox="0 0 24 24" width="60" height="60" fill="#7289da">
                        <path
                            d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037 19.736 19.736 0 0 0-4.885 1.515.069.069 0 0 0-.032.027C.533 9.048-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.28 14.28 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128c.125-.094.249-.192.37-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.1.246.198.37.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z" />
                    </svg>
                </div>
                <h2>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</h2>
                <p>‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Discord ‡∏ï‡∏•‡∏≠‡∏î 24 ‡∏ä‡∏°.</p>
                <a href="https://discord.gg/Bcj7bnVXcU" target="_blank" class="popup-link">Discord:
                    https://discord.gg/Bcj7bnVXcU</a>
            </div>
            <div class="popup-footer">
                <label class="popup-checkbox-container">
                    <input type="checkbox" id="dont-show-hour">
                    <span class="checkmark"></span>
                    ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏µ‡∏Å 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
                </label>
            </div>
        </div>
    </div>

    <!-- History Modal -->

    <div id="history-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="history-list" id="history-list">
                <!-- History items will be generated here -->
                <div class="empty-history">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</div>
            </div>
        </div>
    </div>

    <!-- Payment/Confirm Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content small-modal">
            <h2 style="color: #ff9900; margin-bottom: 12px; font-size: 20px;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h2>
            <p id="confirm-text" style="color: #fff; margin-bottom: 10px;"></p>
            <div class="modal-actions">
                <button class="cancel-btn" onclick="closeConfirmModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="confirm-buy-btn" id="confirm-buy-btn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
            </div>
        </div>
    </div>

    <!-- Alert Modal (Custom Notification UI) -->
    <div id="alert-modal" class="modal" style="z-index: 9999;">
        <div class="modal-content small-modal"
            style="display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; border-color: #ff9900;">
            <div
                style="background-color: rgba(255,153,0,0.1); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 20px;">
                <svg viewBox="0 0 24 24" width="30" height="30" fill="none" stroke="#ff9900" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
            </div>
            <h2 id="alert-title" style="margin-bottom: 12px; font-size: 20px; color: #fff; font-weight: 800;">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            </h2>
            <p id="alert-text" style="color: #b8b8b8; margin-bottom: 24px; font-size: 15px; line-height: 1.5;"></p>
            <button id="alert-modal-btn" class="confirm-buy-btn"
                style="width: 100%; border-radius: 6px; padding: 12px;">‡∏ï‡∏Å‡∏•‡∏á</button>
        </div>
    </div>

    <!-- Product Details Modal -->
    <div id="detail-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div style="display: flex; gap: 20px; align-items: center; margin-bottom: 20px;">
                <div id="detail-image-container" class="product-image"
                    style="width: 140px; height: 140px; flex-shrink: 0; background-color: #121316; border-radius: 12px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                    <div id="detail-img" class="img-placeholder" style="font-size: 16px;"></div>
                </div>
                <div style="flex: 1;">
                    <h3 id="detail-name" style="font-size: 18px; margin-bottom: 8px; color: #fff;"></h3>
                    <p id="detail-desc" style="color: #b8b8b8; font-size: 13px; line-height: 1.6; margin-bottom: 12px;">
                    </p>
                    <div
                        style="color: #4CAF50; font-size: 13px; margin-bottom: 12px; background: rgba(76,175,80,0.1); padding: 8px; border-radius: 6px;">
                        ‚úîÔ∏è ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏û‡∏ó‡∏ä‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î<br>
                        ‚úîÔ∏è ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡∏•‡∏≠‡∏î 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
                    </div>
                </div>
            </div>
            <div
                style="display: flex; justify-content: space-between; align-items: center; background-color: #232527; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                <div style="color: #fff; font-size: 14px;">‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span id="detail-stock"
                        style="font-weight: 700; color: #ff9900;"></span> ‡∏ä‡∏¥‡πâ‡∏ô</div>
                <div style="color: #fff; font-size: 14px;">‡∏£‡∏≤‡∏Ñ‡∏≤: <span id="detail-price"
                        style="font-size: 24px; font-weight: 800; color: #ff9900; margin-left: 8px;"></span> ‡∏ö‡∏≤‡∏ó</div>
            </div>
            <button class="buy-btn" id="detail-buy-btn"
                style="width: 100%; justify-content: center; padding: 12px; font-size: 15px;">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏•‡∏¢</button>
        </div>
    </div>

    <script>
        // API Base configuration
        const API_BASE = "/api";

        // State
        let products = [];
        let currentItemToBuy = null;
        let activeUser = localStorage.getItem('lastLoggedInUser') || "Guest";
        let isFirstConfirm = false;

        // Admin status check (only for UI visibility)
        const isAdmin = localStorage.getItem('isAdminLoggedIn') === 'true';

        // DOM Elements
        const historyModal = document.getElementById('history-modal');
        const confirmModal = document.getElementById('confirm-modal');
        const detailModal = document.getElementById('detail-modal');
        const alertModal = document.getElementById('alert-modal');
        const closeModalsBtns = document.querySelectorAll('.close-modal');

        // Initialize UI
        if (isAdmin) {
            document.getElementById('admin-link').style.display = 'flex';
        }
        document.getElementById('user-display').textContent = `‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ${activeUser}`;

        // Custom Alert Implementation
        function customAlert(text, title = "‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô", onClose = null) {
            document.getElementById('alert-title').textContent = title;
            document.getElementById('alert-text').textContent = text;
            const btn = document.getElementById('alert-modal-btn');
            btn.onclick = function () {
                alertModal.style.display = 'none';
                if (onClose) onClose();
            };
            alertModal.style.display = 'flex';
        }

        // Data Fetching
        async function fetchProducts() {
            try {
                const res = await fetch(`${API_BASE}/products`);
                products = await res.json();
                renderProducts();
            } catch (err) {
                console.error('Fetch products error:', err);
            }
        }

        async function fetchUserBalance() {
            if (activeUser === "Guest") {
                document.getElementById('user-balance').textContent = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô";
                return;
            }
            if (activeUser === "Nitisak22") {
                document.getElementById('user-balance').textContent = "‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô (‡∏ã‡∏∑‡πâ‡∏≠‡∏ü‡∏£‡∏µ)";
                return;
            }
            try {
                const res = await fetch(`${API_BASE}/users`);
                const users = await res.json();
                const user = users.find(u => u.username === activeUser);
                if (user) {
                    document.getElementById('user-balance').textContent = `‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô: ${user.balance || 0} S`;
                }
            } catch (err) {
                console.error('Fetch balance error:', err);
            }
        }

        async function fetchGlobalOrders() {
            try {
                const res = await fetch(`${API_BASE}/orders/all`);
                const orders = await res.json();
                renderCarousel(orders);
            } catch (err) {
                console.error('Fetch global orders error:', err);
            }
        }

        function renderCarousel(orders) {
            const track = document.getElementById('carousel-track');
            if (!track) return;
            track.innerHTML = '';

            if (!orders || orders.length === 0) {
                track.innerHTML = '<div style="color:#666; padding:10px;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>';
                return;
            }

            // Duplicate orders for seamless scroll if there are enough
            const displayOrders = orders.length > 5 ? [...orders, ...orders] : orders;

            displayOrders.forEach((o, index) => {
                const item = document.createElement('div');
                item.className = 'carousel-item';

                let deleteBtn = '';
                if (isAdmin) {
                    deleteBtn = `<button class="c-delete-btn" onclick="deleteGlobalOrder('${o.orderId}', event)">√ó</button>`;
                }

                item.innerHTML = `
                    ${deleteBtn}
                    <div class="c-img">
                        <div style="font-weight:bold; color:#444;">${o.itemName.substring(0, 2)}</div>
                    </div>
                    <div class="c-info">
                        <div class="c-name">${o.itemName}</div>
                        <div class="c-date">${o.date}</div>
                        <div class="c-status">
                            <svg viewBox="0 0 24 24" width="10" height="10" fill="none" stroke="currentColor" stroke-width="3">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            ‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß !!
                        </div>
                    </div>
                `;
                track.appendChild(item);
            });
        }

        async function deleteGlobalOrder(orderId, event) {
            if (event) event.stopPropagation();
            if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? (Admin Only)')) return;

            try {
                const res = await fetch(`${API_BASE}/orders/${orderId}`, {
                    method: 'DELETE'
                });
                const data = await res.json();
                if (data.success) {
                    fetchGlobalOrders();
                }
            } catch (err) {
                console.error('Delete order error:', err);
            }
        }

        // Rendering
        function renderProducts() {
            const grid = document.getElementById('products-grid');
            grid.innerHTML = '';

            products.forEach(p => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.style.position = 'relative';

                let adminTools = '';
                if (activeUser === "Nitisak22") {
                    adminTools = `
                        <div style="position:absolute; top:10px; right:10px; z-index:10;">
                            <button onclick="deleteProduct('${p.id}', event)" style="background:#ff4d4f; color:white; border:none; padding:4px 8px; border-radius:4px; font-size:10px; cursor:pointer; font-weight:bold;">‡∏•‡∏ö</button>
                        </div>
                    `;
                }

                let productImage = `<div class="img-placeholder">${p.imgText || p.name.substring(0, 5)}</div>`;
                if (p.imageUrl) {
                    productImage = `<img src="${p.imageUrl}" alt="${p.name}" style="width: 100%; height: 100%; object-fit: cover;">`;
                }

                card.innerHTML = `
                    ${adminTools}
                    <div class="product-image" onclick="showProductDetails('${p.id}')" style="cursor: pointer;">
                        ${productImage}
                    </div>
                    <div class="product-info">
                        <div class="stock">‡πÄ‡∏´‡∏•‡∏∑‡∏≠ <span style="color:#ff9900; font-weight:bold;">${p.stock}</span> ‡∏ä‡∏¥‡πâ‡∏ô</div>
                        <h3 class="product-name" onclick="showProductDetails('${p.id}')" style="cursor: pointer;">${p.name}</h3>
                        <div class="price-row">
                            <div class="price">
                                <span class="label">‡∏£‡∏≤‡∏Ñ‡∏≤</span>
                                <span class="val">${p.price} ‡∏ø</span>
                            </div>
                            <button class="buy-btn" onclick="buyItem('${p.id}')">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                                    <path d="M16 6V4a4 4 0 0 0-8 0v2H3v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6h-5zM10 4a2 2 0 0 1 4 0v2h-4V4zm9 16H5V8h3v2h2V8h4v2h2V8h3v12z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // Product Actions
        window.deleteProduct = async function (id, e) {
            e.stopPropagation();
            if (!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
            try {
                const res = await fetch(`${API_BASE}/products/${id}`, { method: 'DELETE' });
                const data = await res.json();
                if (data.success) {
                    customAlert('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    fetchProducts();
                } else {
                    customAlert(data.message, '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
                }
            } catch (err) {
                customAlert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ', '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
            }
        };

        function showProductDetails(id) {
            const p = products.find(x => x.id === id);
            if (!p) return;
            currentItemToBuy = p;

            const detailImg = document.getElementById('detail-img');
            if (p.imageUrl) {
                detailImg.innerHTML = `<img src="${p.imageUrl}" alt="${p.name}" style="width: 100%; height: 100%; object-fit: cover;">`;
                detailImg.className = ""; // Remove placeholder styling
            } else {
                detailImg.textContent = p.imgText || p.name.substring(0, 5);
                detailImg.className = "img-placeholder";
                detailImg.style.fontSize = "16px";
            }

            document.getElementById('detail-name').textContent = p.name;
            document.getElementById('detail-desc').textContent = p.desc || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢";
            document.getElementById('detail-stock').textContent = p.stock;
            document.getElementById('detail-price').textContent = p.price;
            detailModal.style.display = 'flex';
        }

        function buyItem(id) {
            const p = products.find(x => x.id === id);
            if (!p) return;
            if (activeUser === "Guest") {
                customAlert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤!", "‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô");
                return;
            }
            if (p.stock <= 0) {
                customAlert("‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ä‡∏¥‡πâ‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏°‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!", "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î");
                return;
            }
            currentItemToBuy = p;
            isFirstConfirm = false;
            const btn = document.getElementById('confirm-buy-btn');
            btn.textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠';
            btn.style.backgroundColor = '';
            document.getElementById('confirm-text').innerHTML = `‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ <strong>"${p.name}"</strong> ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ <span style="color:#ff9900; font-weight:800;">${p.price} ‡∏ø</span> ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`;
            confirmModal.style.display = 'flex';
            detailModal.style.display = 'none';
        }

        document.getElementById('detail-buy-btn').onclick = function () {
            if (currentItemToBuy) {
                buyItem(currentItemToBuy.id);
            }
        };

        document.getElementById('confirm-buy-btn').onclick = async function () {
            if (!currentItemToBuy) return;

            if (!isFirstConfirm) {
                isFirstConfirm = true;
                this.textContent = '‡πÅ‡∏ô‡πà‡πÉ‡∏à ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏•‡∏¢!';
                this.style.backgroundColor = '#ff4d4f';
                document.getElementById('confirm-text').innerHTML = `<span style="color:#ff4d4f;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2:</span> ‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô <span style="color:#ff9900; font-weight:800;">${currentItemToBuy.price} ‡∏ø</span> ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`;
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/buy`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: activeUser,
                        productId: currentItemToBuy.id
                    })
                });
                const data = await res.json();
                if (data.success) {
                    confirmModal.style.display = 'none';
                    let successMsg = '‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏°‡∏°‡∏∏‡∏°‡∏ö‡∏ô‡∏Ç‡∏ß‡∏≤';
                    if (data.downloadLink) {
                        successMsg += `\n\nüîó ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${data.downloadLink}`;
                    }
                    customAlert(successMsg, '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    fetchProducts();
                    fetchUserBalance();
                    fetchGlobalOrders(); // Refresh carousel after purchase
                } else {
                    customAlert(data.message, '‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                }
            } catch (err) {
                customAlert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠', '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
            }
        };

        window.closeConfirmModal = () => confirmModal.style.display = 'none';

        // History
        async function renderHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = '<p style="text-align:center; padding:20px; color:#888;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥...</p>';
            historyModal.style.display = 'flex';

            if (activeUser === "Guest") {
                list.innerHTML = '<p style="text-align:center; color:#ff4d4f; padding:20px;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</p>';
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/orders/${activeUser}`);
                const history = await res.json();
                list.innerHTML = '';
                if (!history || history.length === 0) {
                    list.innerHTML = '<div class="empty-history">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>';
                    return;
                }

                history.reverse().forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'history-item';

                    let downloadBtn = '';
                    if (item.downloadLink) {
                        const isUrl = item.downloadLink.startsWith('http');
                        if (isUrl) {
                            downloadBtn = `<a href="${item.downloadLink}" target="_blank" style="display:inline-block; margin-top:8px; background-color:#4CAF50; color:white; padding:6px 12px; border-radius:4px; text-decoration:none; font-size:12px; font-weight:bold; transition: background 0.2s;">üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>`;
                        } else {
                            downloadBtn = `<div style="display:inline-block; margin-top:8px; background-color:#666; color:white; padding:6px 12px; border-radius:4px; font-size:12px; font-weight:bold;">üîë ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${item.downloadLink}</div>`;
                        }
                    }

                    card.innerHTML = `
                        <div style="flex:1;">
                            <div style="font-weight:bold; color:#ff9900; margin-bottom:4px;">${item.itemName}</div>
                            <div style="font-size:12px; color:#888;">${item.date}</div>
                            <div style="font-size:12px; color:#4CAF50; margin-top:5px; font-weight:bold;">${item.message || `‡∏£‡∏´‡∏±‡∏™‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠: ${item.orderId}`}</div>
                            ${downloadBtn}
                        </div>
                        <div style="text-align:right;">
                            <div style="font-weight:800; color:#fff;">${item.price} ‡∏ø</div>
                        </div>
                    `;
                    list.appendChild(card);
                });
            } catch (err) {
                list.innerHTML = '<p style="text-align:center; color:#ff4d4f;">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</p>';
            }
        }

        document.getElementById('history-btn').onclick = renderHistory;

        // Modals closure
        closeModalsBtns.forEach(btn => {
            btn.onclick = () => {
                historyModal.style.display = 'none';
                detailModal.style.display = 'none';
            };
        });

        // Initial Load
        fetchProducts();
        fetchUserBalance();
        fetchGlobalOrders();
        setInterval(fetchProducts, 5000); // Background refresh every 5s
        setInterval(fetchGlobalOrders, 5000); // Carousel refresh every 5s

        // Popup Logic
        const popup = document.getElementById('announcement-popup');
        window.closePopup = () => {
            const dontShow = document.getElementById('dont-show-hour').checked;
            if (dontShow) {
                const expiry = Date.now() + (60 * 60 * 1000); // 1 hour from now
                localStorage.setItem('hideAnnouncementUntil', expiry);
            }
            popup.style.display = 'none';
        }

        function checkAnnouncementPopup() {
            const hideUntil = localStorage.getItem('hideAnnouncementUntil');
            if (!hideUntil || Date.now() > parseInt(hideUntil)) {
                popup.style.display = 'flex';
            }
        }

        // Show popup on load
        setTimeout(checkAnnouncementPopup, 0);

        // Top-up Button & Balance Click
        const showTopupPopup = () => {
            popup.style.display = 'flex';
        };
        document.getElementById('topup-btn').onclick = showTopupPopup;
        document.getElementById('user-balance').onclick = showTopupPopup;

        // Logout
        document.getElementById('logout-btn').onclick = () => {
            localStorage.removeItem('lastLoggedInUser');
            localStorage.removeItem('isAdminLoggedIn');
            window.location.href = 'login.html';
        };

        window.onclick = (e) => {
            if (e.target == historyModal) historyModal.style.display = 'none';
            if (e.target == confirmModal) confirmModal.style.display = 'none';
            if (e.target == detailModal) detailModal.style.display = 'none';
            if (e.target == alertModal) alertModal.style.display = 'none';
            if (e.target == popup) popup.style.display = 'none';
        };

    </script>
</body>

</html>