<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Set shop - ลงทะเบียน</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;600;700;800&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="background-wrapper">
        <div class="bg-blur"></div>
    </div>
    <div class="signup-container">
        <h1 class="logo">Set shop</h1>
        <div class="signup-box">
            <h2>ลงทะเบียนและไปร่วมสนุกกันได้เลย!</h2>

            <form action="home.html" id="signup-form">
                <!-- วันเกิด -->
                <div class="form-group">
                    <label>วันเกิด</label>
                    <div class="date-group">
                        <div class="select-wrapper">
                            <select required>
                                <option value="" disabled selected>วัน</option>
                                <script>
                                    for (let i = 1; i <= 31; i++) document.write(`<option value="${i}">${i}</option>`);
                                </script>
                            </select>
                        </div>
                        <div class="select-wrapper">
                            <select required>
                                <option value="" disabled selected>เดือน</option>
                                <option value="1">มกราคม</option>
                                <option value="2">กุมภาพันธ์</option>
                                <option value="3">มีนาคม</option>
                                <option value="4">เมษายน</option>
                                <option value="5">พฤษภาคม</option>
                                <option value="6">มิถุนายน</option>
                                <option value="7">กรกฎาคม</option>
                                <option value="8">สิงหาคม</option>
                                <option value="9">กันยายน</option>
                                <option value="10">ตุลาคม</option>
                                <option value="11">พฤศจิกายน</option>
                                <option value="12">ธันวาคม</option>
                            </select>
                        </div>
                        <div class="select-wrapper">
                            <select required>
                                <option value="" disabled selected>ปี</option>
                                <script>
                                    const year = new Date().getFullYear();
                                    for (let i = year; i >= year - 100; i--) document.write(`<option value="${i}">${i}</option>`);
                                </script>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ชื่อผู้ใช้ -->
                <div class="form-group">
                    <label>ชื่อผู้ใช้</label>
                    <input type="text" placeholder="อย่าใช้ชื่อจริงของคุณ" required>
                </div>

                <!-- รหัสผ่าน -->
                <div class="form-group">
                    <label>รหัสผ่าน</label>
                    <input type="password" placeholder="อย่างน้อย 8 อักขระ" required minlength="8">
                </div>

                <!-- เพศ -->
                <div class="form-group">
                    <label>เพศ (ไม่จำเป็น)</label>
                    <div class="gender-group">
                        <label class="gender-option">
                            <input type="radio" name="gender" value="female">
                            <div class="gender-btn">
                                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                    <rect x="10" y="2" width="4" height="4" rx="2" />
                                    <path d="M9 7h6l2.5 8h-2.5v7h-2v-5h-2v5H9v-7H6.5L9 7z" />
                                </svg>
                            </div>
                        </label>
                        <label class="gender-option">
                            <input type="radio" name="gender" value="male">
                            <div class="gender-btn">
                                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                    <rect x="10" y="2" width="4" height="4" rx="2" />
                                    <path d="M7 7h10a1 1 0 0 1 1 1v6h-2v8h-3v-6h-2v6H8v-8H6V8a1 1 0 0 1 1-1z" />
                                </svg>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- ข้อกำหนด -->
                <p class="terms">
                    การคลิกลงทะเบียนถือว่าคุณยอมรับข้อกำหนดการใช้งาน
                    และรับทราบนโยบายความเป็นส่วนตัวของเรา หากคุณมีอายุต่ำกว่า 18 ปี
                    คุณยอมรับว่าพ่อแม่/ผู้ปกครองอนุญาตให้คุณสร้างบัญชีนี้และยอมรับข้อกำหนดการใช้งานของเรา
                </p>

                <!-- Submit -->
                <button type="submit" class="submit-btn" disabled>ลงทะเบียน</button>

                <div style="text-align: center; margin-top: 24px; font-size: 13px; color: #ffffff; font-weight: 700;">
                    มีบัญชีอยู่แล้วใช่ไหม? <a href="login.html"
                        style="color: #ffffff; text-decoration: underline;">ลงชื่อเข้าใช้</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        // เปลียนสถานะปุ่มเมื่อกรอกฟอร์มครบ
        const form = document.getElementById('signup-form');
        const submitBtn = document.querySelector('.submit-btn');

        form.addEventListener('input', () => {
            if (form.checkValidity()) {
                submitBtn.removeAttribute('disabled');
            } else {
                submitBtn.setAttribute('disabled', 'true');
            }
        });

        // บันทึกข้อมูลเพื่อใช้ลงชื่อเข้าใช้ภายหลัง
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const usernameInput = form.querySelector('input[type="text"]');
            const passwordInput = form.querySelector('input[type="password"]');

            const API_BASE = "/api";

            fetch(`${API_BASE}/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    username: usernameInput.value,
                    password: passwordInput.value
                })
            })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('ลงทะเบียนสำเร็จ!');
                        window.location.href = 'login.html';
                    } else {
                        alert('ข้อผิดพลาด: ' + data.message);
                    }
                })
                .catch(err => {
                    console.error(err);
                    alert('ไม่สามารถเชื่อมต่อกับเซิร์ฟเวอร์ได้ กรุณาตรวจสอบว่าเซิร์ฟเวอร์ทำงานอยู่');
                });
        });
    </script>
</body>

</html>